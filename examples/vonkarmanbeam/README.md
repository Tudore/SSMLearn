This is a preview of the livescript `vonkarmanbeam.mlx`.

# Finding a 2D SSM for a von Kármán beam

This is an example of how to reconstruct a slow 2D SSM of a mechanical system using synthetic measurements of a scalar quantity. In this example, we measure the midpoint displacement of a clamped-clamped von Kármán beam. [1]

![image_0.png
](README_images/image_0.png
)

[1] S. Jain, P. Tiso, and G. Haller, Exact nonlinear model reduction for a von Kármán beam: slow-fast decomposition and spectral submanifolds, *Journal of Sound and Vibration* 423 (2018) 195-211. [https://doi.org/10.1016/j.jsv.2018.01.049](https://doi.org/10.1016/j.jsv.2018.01.049) 

```matlab:Code
clearvars
close all
```

# Example setup

The $N$-degree of freedom dynamical system is of the form

$$
{M\ddot{q} }+{C\dot{q} }+{Kq}+f(q,{\dot{q} })=0
$$

where $f=\mathcal{O}(|q|^2 ,|{\dot{q} }|^2 ,|q||{\dot{q} }|)$ represents the nonlinearities and $M$, $C$, and $K$ are the $n\times n$ mass, stiffness, and damping matrices, respectively.

We rewrite the system in first-order form as

$$
{\dot{x} }=Ax+G(x)=F(x)
$$

with

$x=\left\lbrack \begin{array}{c}
q\\
\dot{q} 
\end{array}\right\rbrack ,~~A=\left\lbrack \begin{array}{cc}
0 & I\\
-M^{-1} K & -M^{-1} C
\end{array}\right\rbrack ,~~G(x)=\left\lbrack \begin{array}{c}
0\\
-M^{-1} f(x)
\end{array}\right\rbrack$.

```matlab:Code
nElements = 12;
[M, C, K, fnl, fExt, outdof, PlotFieldonDefMesh] = buildModel(nElements);
```

```text:Output
Building FE model
```

![figure_0.png
](README_images/figure_0.png
)

```text:Output
Assembling M,C,K matrices
Applying boundary conditions
Solving undamped eigenvalue problem
```

![figure_1.png
](README_images/figure_1.png
)

```text:Output
Assembling external force vector
Getting nonlinearity coefficients
Assembling Tensors
Total time spent on model assembly = 00:00:00
```

```matlab:Code
n = size(M,1);    % mechanical dofs (axial def, transverse def, angle)
[F, lambda] = functionFromTensors(M, C, K, fnl);
```

# Generation of Synthetic Data

Having set up the dynamics of the problem, we now move on to generate synthetic data, which will be used to fit a parametrisation of the manifold. We will divide the data into a training set, for model fitting, and a test set, for validation. In this case we will use one trajectory as the training set and another one as the test set.

```matlab:Code
loads = -[12 14]*1e3;
nTraj = size(loads, 2);
indTest = 1;
indTrain = 2;
```

We now set the initial conditions for the trajectories. Our test set trajectory is initialized by applying a point load at the midpoint of the beam. The load is removed at the start of the simulation. For the training trajectory, we use a different point load magnitude. We expect the trajectories to eventually converge onto a slow 2D manifold, which will be identified and used to reduce the system dynamics.

```matlab:Code
loadvector = loads.*fExt;
IC = getStaticResponse(K, M, F, loadvector, true, PlotFieldonDefMesh);
```

![figure_2.png
](README_images/figure_2.png
)

The data is generated by time-integration of the right-hand side of the system. In this case we are observing the midpoint displacement, so the `observable` function is selected to save only the transverse displacement of the center element. We also make sure that the data is sampled with a sufficiently high frequency.

To save execution time and avoid rerunning the simulation, `newMeasurement` can be set to `false`.

```matlab:Code
newMeasurement = false;
observable = @(x) x(outdof,:);
slowTimeScale = 2*pi/abs(lambda(1));
numberPeriods = 125; numberPointsPerPeriod = 100;
if newMeasurement
    endTime = numberPeriods*slowTimeScale;
    nSamp = numberPeriods*numberPointsPerPeriod+1;
    dt = endTime/(nSamp-1);
    xData = integrateTrajectories(F, endTime, IC, nSamp, observable);
    DataInfo = struct('nElements', nElements, 'loadvector', loadvector);
    save('dataVKDecay.mat', 'DataInfo', 'xData', 'dt', 'endTime', 'nSamp')
else
    load dataVKDecay.mat
    if nElements ~= DataInfo.nElements
       error('The loaded data comes from a model with a different number of elements.') 
    end
end
```

# Delay embedding

Now we arrange the scalar measurements in an observable space of dimension at least $2m+1$, with $m$ the dimension of the manifold. This guarantees that the manifold from the full state space can be embedded in the observable space. The dimensionality of the observable space can be further expanded with the parameter `overEmbed` to facilitate recognition of the manifold from data.

We form a multi-dimensional observable by stacking $d$ subsequent scalar measurements $x$ in a vector $y$, and we will later use the trajectories in this augmented space for the manifold fitting.

$$
\left\lbrack \begin{array}{c}
y_1 \\
\vdots \\
y_{i+1} \\
\vdots \\
y_{d+1} 
\end{array}\right\rbrack =\left\lbrack \begin{array}{c}
x(t^k )\\
\vdots \\
x(t^k +i\Delta t)\\
\vdots \\
x(t^k +d\Delta t)
\end{array}\right\rbrack
$$

The total number of embedded coordinates is $2m+1+{\textrm{overEmbed}}$.

```matlab:Code
SSMDim = 2;
overEmbed = 0;
yData = coordinatesEmbedding(xData, SSMDim, 'OverEmbedding', overEmbed);
```

```text:Output
The 5 embedding coordinates consist of the measured state and its 4 time-delayed measurements.
```

# Data analysis

We need to make sure that the data that we use to identify the slow manifold lies close to it. We can do this by plotting a spectrogram of the beam tip displacement. In general, there may be many vibratory modes present at first, but the faster ones quickly die out.

```matlab:Code
showSpectrogram(yData(indTrain,:), 1);
ylim([0,abs(lambda(1))/2/pi*5])
```

We plot the tip displacement over time for closer inspection. 

```matlab:Code
customFigure();
plot(xData{1,1}, xData{1,2}, xData{2,1}, xData{2,2}, ':');
xlabel('$t \, [$s$]$','Interpreter','latex'); 
ylabel('$u \, [$m$]$','Interpreter','latex'); 
legend({'Trajectory 1', 'Trajectory 2'})
title('Generated data')
```

![figure_3.png
](README_images/figure_3.png
)

Next, we use the information from the spectrogram and plot to remove the first part of the training data. After the first few oscillations have passed, there is one dominant mode left in the frequency spectrum. In this case, faster modes die out very quickly, so we can use almost all of the data. We must however remove the first transient to fulfill the assumption that trajectories lie close to the SSM. We keep only the time interval `sliceInt`.

```matlab:Code
sliceInt = [4*slowTimeScale, endTime];
yDataTrunc = sliceTrajectories(yData, sliceInt);
```

# Datadriven manifold fitting

The measured trajectories are assumed to lie close to a two-dimensional manifold that is tangent at the origin to the eigenspace corresponding to the slowest pair of eigenvalues. We now want to fit a polynomial of order $M$ to the data points to approximate the manifold. Here we use a graph style parametrization, meaning that the manifold is parametrized using coordinates in the computed eigenspace $V_e$. This excludes the possibility of folds on the manifold (however, if necessary we may circumvent this problem by increasing the dimensionality of the observed space). 

![image_1.png
](README_images/image_1.png
)

We seek the $2n\times m_M$ polynomial coefficient matrix $H$ of the manifold on the form

$y=V_e V_e^{\top } y+H\phi_{m,2:M} (V_e^{\top } y)$,

where the function $\phi_{m,2:M} (q)$ computes a vector of all $m_M$ monomials from orders 2 up to $M$ of an $m$-vector $q$. This optimization problem is formulated as the minimization of a cost function computed from the measured data $y_k$,

$$
C_r (V_e ,H)=\sum_{k=1}^N ||y_k -V_e V_e^{\top } y_k -H\phi_{m,2:M} (V_e^{\top } y_k )||
$$

to find $H$ and the $2n\times 2$ eigenspace matrix $V_e$, under the constraints that $V_e^{\top } H=0$ and $V_e^{\top } V_e =I$. The minimization is performed with the Matlab function `fmincon` in `IMGeometry`.

```matlab:Code
SSMOrder = 1;
[IMInfo, SSMChart, SSMFunction] = IMGeometry(yDataTrunc(indTrain,:), SSMDim, SSMOrder);
```

# Plot and validation

Now that we have computed the eigenspace of the manifold, we pass to the reduced coordinates $y$ by projecting all trajectories onto the eigenspace:

$\eta =V_e^{\top } y$.

```matlab:Code
etaData = projectTrajectories(IMInfo, yData);
etaDataTrunc = projectTrajectories(IMInfo, yDataTrunc);
```

We plot the test and training set trajectories projected onto the plane. After all initial transients die out, the trajectories seem to be confined to a slowly decaying oscillating eigenmode. This is the data we will use to train our reduced order model for the dynamics. In these coordinates, the initial transient that we removed is visible as irregular high-frequency oscillations in the first revolution.

```matlab:Code
plotReducedCoordinates(etaData);
legend({'Test set trajectory', 'Training set trajectory'})
```

![figure_4.png
](README_images/figure_4.png
)

Furthermore, we draw the end tip component of the manifold shape along with the truncated trajectory from the training set. 

```matlab:Code
plotSSMWithTrajectories(IMInfo, 1, yDataTrunc(indTrain,:))
view(-100,20); zlabel('$u \, [$m$]$','Interpreter','latex')
```

![figure_5.png
](README_images/figure_5.png
)

# Reduced order model

We compute a model for the reduced dynamics with the truncated training data projected onto the manifold. The function `IMDynamicsFlow` fits a polynomial map

$$
\dot{\eta} =W_r \phi (\eta )
$$

where $\phi (\eta )$ again computes a vector of all monomials of $\eta$, and  $W_r$ is a matrix of polynomial coefficients. 

We are also specifying that we want the reduced dynamics on a normal form, and seek the Taylor expansion of a map $N$ fulfilling

$$
\dot{z} =N(z)=Dz+W_n \phi (z)
$$

with $D$ a diagonal matrix and $W_n$ containing coefficients for the near-resonant nonlinear terms, after a near-identity change of coordinates

$$
z=T^{-1} (\eta )=\eta +W_t \phi (\eta )
$$

with $W_t$ containing the coefficients for the nonlinear terms of the coordinate change.

```matlab:Code
ROMOrder = 7;
RDInfo = IMDynamicsFlow(etaDataTrunc(indTrain,:), ...
    'R_PolyOrd', ROMOrder, 'style', 'normalform');
```

```text:Output
Estimation of the reduced dynamics...  Done. 
Estimation of the reduced dynamics in normal form...
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
     0           1          879.584                      2.03e+03
     1           2          269.471    0.000491843       3.46e+03  
     2           4          102.793       0.277922            611  
     3           5          17.7056              1            255  
     4           6          6.88123              1           40.9  
     5           7          6.41221              1           53.8  
     6           9          6.14447       0.409598           49.8  
     7          10          5.58621              1           18.6  
     8          11          5.34047              1           19.3  
     9          12          5.10719              1           21.2  
    10          13          4.82521              1           15.1  
    11          14          4.67595              1             10  
    12          15          4.61758              1           9.51  
    13          16          4.58196              1           7.65  
    14          17          4.53508              1           6.98  
    15          18          4.49229              1           5.55  
    16          19          4.46925              1              3  
    17          20          4.46132              1           2.62  
    18          21          4.45671              1           2.46  
    19          22          4.44994              1           2.37  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
    20          23          4.43728              1           4.02  
    21          24          4.41005              1           7.51  
    22          25           4.3505              1             12  
    23          26           4.2312              1           16.5  
    24          27          4.04953              1           17.3  
    25          28          3.88716              1             11  
    26          29          3.81983              1           3.39  
    27          30          3.80369              1           2.67  
    28          31          3.79409              1           2.65  
    29          32          3.77478              1           3.69  
    30          33          3.74614              1           4.25  
    31          34          3.71362              1           5.97  
    32          35          3.68848              1           7.48  
    33          36          3.66813              1           7.28  
    34          37          3.64408              1           5.78  
    35          38           3.6137              1           4.15  
    36          39          3.58789              1           2.94  
    37          40          3.57513              1           2.21  
    38          41          3.56961              1           2.33  
    39          42          3.56429              1           2.31  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
    40          43          3.55495              1           2.74  
    41          44          3.53871              1           5.22  
    42          45          3.51293              1           6.98  
    43          46          3.48188              1           7.43  
    44          47          3.45791              1           5.29  
    45          48          3.44699              1           2.17  
    46          49          3.44273              1           1.57  
    47          50          3.43946              1           1.58  
    48          51          3.43451              1           2.77  
    49          52          3.42602              1           4.28  
    50          53          3.41086              1           5.63  
    51          54          3.38696              1           6.26  
    52          55          3.35921              1           6.84  
    53          56          3.34056              1            4.2  
    54          57          3.33414              1           1.52  
    55          58          3.33239              1           1.23  
    56          59          3.33116              1           1.09  
    57          60          3.32929              1           1.51  
    58          61          3.32703              1           1.32  
    59          62          3.32503              1           1.28  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
    60          63          3.32371              1           1.59  
    61          64          3.32255              1            1.6  
    62          65          3.32073              1           1.38  
    63          66          3.31782              1           1.44  
    64          67          3.31464              1           1.26  
    65          68          3.31283              1          0.829  
    66          69          3.31223              1          0.797  
    67          70          3.31188              1          0.723  
    68          71          3.31122              1           0.63  
    69          72           3.3101              1          0.994  
    70          73          3.30872              1            1.1  
    71          74          3.30784              1          0.691  
    72          75          3.30752              1          0.392  
    73          76          3.30738              1          0.352  
    74          77          3.30714              1          0.496  
    75          78          3.30667              1           1.02  
    76          79          3.30577              1           1.58  
    77          80           3.3044              1           1.84  
    78          81            3.303              1           1.37  
    79          82          3.30219              1          0.829  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
    80          83          3.30185              1          0.665  
    81          84          3.30163              1          0.462  
    82          85          3.30137              1          0.571  
    83          86          3.30108              1          0.427  
    84          87          3.30083              1          0.502  
    85          88          3.30062              1          0.634  
    86          89          3.30034              1          0.696  
    87          90          3.29977              1          0.807  
    88          91          3.29842              1           1.19  
    89          92           3.2954              1            1.6  
    90          93          3.28965              1           1.92  
    91          94          3.28219              1           1.84  
    92          95          3.27727              1          0.959  
    93          96          3.27597              1           0.44  
    94          97          3.27578              1          0.394  
    95          98          3.27566              1          0.372  
    96          99          3.27529              1          0.327  
    97         100          3.27442              1          0.624  
    98         101          3.27223              1            1.2  
    99         102          3.26728              1           2.02  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   100         103          3.25774              1           2.88  
   101         104          3.24513              1           2.99  
   102         105          3.23643              1           1.85  
   103         106          3.23398              1          0.685  
   104         107          3.23366              1          0.295  
   105         108          3.23356              1          0.284  
   106         109           3.2334              1          0.299  
   107         110          3.23314              1          0.704  
   108         111          3.23259              1           1.25  
   109         112          3.23145              1           1.88  
   110         113          3.22927              1           2.38  
   111         114          3.22628              1           2.19  
   112         115          3.22394              1           1.12  
   113         116          3.22298              1           1.06  
   114         117          3.22254              1           1.03  
   115         118          3.22186              1          0.942  
   116         119          3.22035              1           1.37  
   117         120          3.21757              1           1.76  
   118         121          3.21408              1           1.56  
   119         122          3.21192              1           0.73  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   120         123          3.21138              1           0.23  
   121         124          3.21128              1          0.236  
   122         125          3.21118              1           0.24  
   123         126          3.21088              1          0.313  
   124         127           3.2102              1          0.521  
   125         128          3.20866              1          0.769  
   126         129          3.20595              1           1.07  
   127         130          3.20286              1           1.05  
   128         131          3.20112              1          0.747  
   129         132          3.20064              1          0.746  
   130         133          3.20044              1          0.713  
   131         134          3.20005              1          0.655  
   132         135          3.19916              1           1.04  
   133         136          3.19724              1           1.93  
   134         137           3.1938              1           2.81  
   135         138          3.18954              1           2.89  
   136         139          3.18676              1           1.75  
   137         140          3.18597              1          0.549  
   138         141          3.18586              1         0.0928  
   139         142          3.18584              1         0.0832  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   140         143          3.18583              1         0.0831  
   141         144          3.18581              1          0.096  
   142         145          3.18577              1           0.12  
   143         146          3.18568              1          0.162  
   144         147          3.18548              1          0.224  
   145         148          3.18514              1          0.242  
   146         149           3.1848              1          0.316  
   147         150          3.18463              1           0.36  
   148         151          3.18457              1          0.345  
   149         152          3.18452              1          0.322  
   150         153          3.18439              1          0.278  
   151         154          3.18409              1          0.246  
   152         155          3.18337              1          0.368  
   153         156          3.18197              1          0.471  
   154         157          3.18006              1          0.437  
   155         158          3.17873              1          0.225  
   156         159          3.17835              1           0.22  
   157         160           3.1783              1          0.221  
   158         161          3.17827              1          0.217  
   159         162          3.17818              1          0.205  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   160         163          3.17797              1          0.179  
   161         164          3.17749              1          0.156  
   162         165           3.1766              1          0.227  
   163         166          3.17549              1          0.228  
   164         167          3.17482              1          0.246  
   165         168          3.17464              1          0.244  
   166         169          3.17461              1          0.227  
   167         170          3.17456              1          0.209  
   168         171          3.17442              1          0.197  
   169         172          3.17408              1          0.205  
   170         173          3.17321              1          0.214  
   171         174          3.17111              1          0.339  
   172         175          3.16661              1          0.483  
   173         176          3.15928              1          0.528  
   174         177           3.1523              1          0.355  
   175         178          3.14944              1          0.362  
   176         179          3.14902              1          0.343  
   177         180          3.14897              1          0.335  
   178         181          3.14891              1          0.327  
   179         182          3.14873              1           0.31  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   180         183           3.1483              1          0.278  
   181         184          3.14727              1          0.216  
   182         185           3.1452              1          0.169  
   183         186          3.14218              1          0.181  
   184         187          3.13985              1          0.111  
   185         188          3.13912              1          0.101  
   186         189          3.13905              1          0.105  
   187         190          3.13904              1          0.105  
   188         191          3.13902              1          0.104  
   189         192          3.13898              1          0.104  
   190         193          3.13886              1          0.103  
   191         194          3.13857              1          0.102  
   192         195          3.13787              1         0.0998  
   193         196           3.1364              1          0.103  
   194         197          3.13412              1          0.153  
   195         198          3.13212              1          0.204  
   196         199          3.13137              1          0.203  
   197         200          3.13126              1          0.187  
   198         201          3.13122              1           0.18  
   199         202          3.13115              1          0.167  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   200         203          3.13096              1          0.146  
   201         204          3.13047              1          0.151  
   202         205          3.12933              1          0.161  
   203         206          3.12705              1          0.154  
   204         207          3.12385              1          0.116  
   205         208          3.12149              1          0.135  
   206         209           3.1208              1          0.155  
   207         210          3.12073              1          0.155  
   208         211          3.12072              1          0.154  
   209         212          3.12069              1          0.151  
   210         213          3.12061              1          0.148  
   211         214           3.1204              1          0.141  
   212         215          3.11987              1          0.131  
   213         216          3.11862              1          0.115  
   214         217          3.11604              1          0.235  
   215         218          3.11214              1           0.38  
   216         219          3.10888              1          0.441  
   217         220          3.10774              1          0.395  
   218         221          3.10756              1          0.351  
   219         222           3.1075              1          0.334  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   220         223          3.10733              1            0.3  
   221         224          3.10693              1          0.249  
   222         225           3.1059              1          0.197  
   223         226          3.10354              1          0.171  
   224         227          3.09895              1          0.148  
   225         228          3.09295              1          0.264  
   226         229          3.08899              1          0.212  
   227         230          3.08799              1          0.175  
   228         231           3.0879              1          0.177  
   229         232          3.08788              1          0.176  
   230         233          3.08782              1          0.173  
   231         234          3.08768              1          0.168  
   232         235          3.08731              1          0.157  
   233         236           3.0864              1          0.133  
   234         237          3.08431              1          0.183  
   235         238          3.08041              1          0.255  
   236         239          3.07562              1          0.241  
   237         240          3.07277              1          0.151  
   238         241          3.07213              1          0.161  
   239         242          3.07207              1          0.161  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   240         243          3.07205              1          0.161  
   241         244          3.07198              1           0.16  
   242         245           3.0718              1          0.158  
   243         246          3.07132              1          0.156  
   244         247           3.0701              1          0.151  
   245         248          3.06688              1          0.144  
   246         249          3.05866              1          0.233  
   247         250          3.03817              1          0.373  
   248         251          2.99107              1          0.553  
   249         252          2.90121              1          0.733  
   250         253          2.78622              1           0.82  
   251         254          2.71355              1           1.03  
   252         255          2.69645              1           1.02  
   253         256          2.69499              1          0.982  
   254         257          2.69475              1          0.971  
   255         258          2.69406              1          0.947  
   256         259          2.69242              1           0.91  
   257         260          2.68805              1          0.841  
   258         261          2.67732              1          0.719  
   259         262          2.65234              1          0.503  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   260         263          2.60418              1          0.238  
   261         264          2.54093              1          0.224  
   262         265          2.49937              1          0.207  
   263         266          2.48914              1         0.0928  
   264         267          2.48835              1         0.0864  
   265         268          2.48833              1         0.0864  
   266         269          2.48832              1         0.0864  
   267         270          2.48828              1         0.0862  
   268         271          2.48821              1         0.0859  
   269         272            2.488              1         0.0854  
   270         273          2.48746              1         0.0847  
   271         274          2.48604              1         0.0835  
   272         275          2.48237              1          0.125  
   273         276          2.47295              1          0.214  
   274         277          2.44957              1          0.347  
   275         278          2.39613              1          0.518  
   276         279          2.29585              1          0.656  
   277         280          2.17183              1          0.706  
   278         281          2.09727              1          0.912  
   279         282          2.08059              1          0.923  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   280         283          2.07926              1          0.896  
   281         284          2.07904              1          0.887  
   282         285          2.07835              1          0.868  
   283         286          2.07674              1          0.838  
   284         287          2.07239              1          0.782  
   285         288          2.06162              1          0.683  
   286         289          2.03586              1          0.502  
   287         290          1.98306              1          0.211  
   288         291          1.90444              1          0.181  
   289         292          1.84059              1           0.29  
   290         293          1.81957              1          0.299  
   291         294          1.81732              1          0.308  
   292         295          1.81722              1          0.308  
   293         296          1.81718              1          0.307  
   294         297          1.81699              1          0.306  
   295         298          1.81659              1          0.304  
   296         299          1.81546              1            0.3  
   297         300           1.8126              1          0.293  
   298         301          1.80515              1          0.282  
   299         302          1.78654              1           0.26  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   300         303          1.74286              1           0.42  
   301         304          1.65584              1          0.614  
   302         305          1.53395              1           0.66  
   303         306          1.44452              1          0.748  
   304         307          1.41916              1          0.809  
   305         308          1.41675              1          0.788  
   306         309          1.41654              1          0.779  
   307         310          1.41623              1          0.769  
   308         311          1.41534              1          0.749  
   309         312          1.41311              1          0.715  
   310         313           1.4073              1          0.654  
   311         314          1.39299              1          0.542  
   312         315          1.36022              1          0.347  
   313         316          1.29886              1          0.162  
   314         317            1.223              1          0.208  
   315         318          1.17757              1          0.261  
   316         319          1.16761              1          0.305  
   317         320          1.16692              1          0.312  
   318         321          1.16688              1          0.311  
   319         322          1.16685              1          0.311  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   320         323          1.16672              1           0.31  
   321         324          1.16642              1          0.308  
   322         325          1.16561              1          0.303  
   323         326          1.16357              1          0.291  
   324         327          1.15855              1          0.264  
   325         328          1.14741              1          0.207  
   326         329          1.12774              1          0.206  
   327         330          1.10615              1          0.186  
   328         331          1.09535              1         0.0831  
   329         332          1.09345              1         0.0638  
   330         333          1.09335              1         0.0637  
   331         334          1.09334              1         0.0637  
   332         335          1.09334              1         0.0637  
   333         336          1.09333              1         0.0637  
   334         337          1.09329              1         0.0636  
   335         338          1.09321              1         0.0636  
   336         339          1.09298              1         0.0635  
   337         340          1.09239              1         0.0634  
   338         341          1.09085              1         0.0632  
   339         342          1.08684              1         0.0664  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   340         343          1.07655              1          0.125  
   341         344          1.05093              1          0.213  
   342         345         0.991949              1          0.328  
   343         346         0.879255              1          0.425  
   344         347         0.734554              1          0.392  
   345         348         0.642551              1          0.417  
   346         349         0.620895              1          0.424  
   347         350          0.61927              1           0.41  
   348         351         0.619199              1          0.407  
   349         352         0.619137              1          0.405  
   350         353         0.618905              1            0.4  
   351         354         0.618369              1          0.393  
   352         355         0.616898              1          0.379  
   353         356         0.613156              1          0.357  
   354         357         0.603535              1          0.318  
   355         358          0.58001              1          0.249  
   356         359          0.52775              1           0.16  
   357         360         0.435934              1          0.189  
   358         361         0.335738              1          0.149  
   359         362         0.286402              1         0.0819  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   360         363         0.277914              1         0.0275  
   361         364         0.277467              1         0.0274  
   362         365         0.277461              1         0.0273  
   363         366          0.27746              1         0.0273  
   364         367         0.277457              1         0.0273  
   365         368          0.27745              1         0.0273  
   366         369         0.277429              1         0.0272  
   367         370         0.277378              1          0.027  
   368         371         0.277243              1         0.0268  
   369         372         0.276896              1         0.0263  
   370         373         0.276017              1         0.0254  
   371         374         0.273906              1         0.0334  
   372         375         0.269459              1          0.046  
   373         376          0.26248              1         0.0489  
   374         377         0.256278              1         0.0481  
   375         378          0.25399              1         0.0535  
   376         379          0.25371              1          0.051  
   377         380         0.253699              1         0.0499  
   378         381         0.253698              1         0.0497  
   379         382         0.253694              1         0.0493  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   380         383         0.253686              1         0.0487  
   381         384         0.253664              1         0.0477  
   382         385         0.253606              1         0.0461  
   383         386         0.253454              1         0.0433  
   384         387         0.253064              1         0.0387  
   385         388          0.25207              1          0.031  
   386         389         0.249671              1         0.0184  
   387         390         0.244533              1         0.0165  
   388         391         0.236183              1         0.0193  
   389         392         0.228286              1         0.0238  
   390         393         0.225107              1         0.0128  
   391         394         0.224678              1         0.0131  
   392         395         0.224661              1         0.0129  
   393         396         0.224661              1         0.0129  
   394         397         0.224661              1         0.0129  
   395         398          0.22466              1         0.0128  
   396         399         0.224659              1         0.0128  
   397         400         0.224655              1         0.0127  
   398         401         0.224645              1         0.0126  
   399         402         0.224619              1         0.0124  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   400         403         0.224553              1          0.012  
   401         404         0.224381              1         0.0113  
   402         405         0.223952              1        0.00986  
   403         406         0.222952              1        0.00876  
   404         407         0.220988              1        0.00994  
   405         408         0.218328              1         0.0177  
   406         409         0.216483              1          0.023  
   407         410         0.215995              1         0.0233  
   408         411         0.215955              1         0.0225  
   409         412         0.215954              1         0.0222  
   410         413         0.215953              1         0.0222  
   411         414         0.215953              1         0.0221  
   412         415         0.215951              1          0.022  
   413         416         0.215946              1         0.0217  
   414         417         0.215935              1         0.0212  
   415         418         0.215905              1         0.0202  
   416         419          0.21583              1         0.0185  
   417         420          0.21565              1         0.0151  
   418         421         0.215281              1        0.00915  
   419         422         0.214729              1        0.00366  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   420         423         0.214277              1        0.00301  
   421         424         0.214129              1        0.00224  
   422         425         0.214113              1        0.00165  
   423         426         0.214113              1        0.00166  
   424         427         0.214112              1        0.00166  
   425         428         0.214112              1        0.00166  
   426         429         0.214112              1        0.00166  
   427         430         0.214112              1        0.00167  
   428         431         0.214112              1        0.00167  
   429         432         0.214112              1        0.00167  
   430         433         0.214112              1        0.00168  
   431         434         0.214111              1        0.00169  
   432         435         0.214108              1         0.0017  
   433         436         0.214102              1         0.0017  
   434         437         0.214085              1        0.00168  
   435         438         0.214045              1        0.00182  
   436         439         0.213964              1        0.00254  
   437         440         0.213846              1        0.00262  
   438         441         0.213753              1        0.00158  
   439         442         0.213724              1        0.00056  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   440         443         0.213721              1       0.000559  
   441         444         0.213721              1       0.000559  
   442         445         0.213721              1       0.000559  
   443         446         0.213721              1       0.000559  
   444         447         0.213721              1       0.000559  
   445         448         0.213721              1       0.000559  
   446         449         0.213721              1       0.000559  
   447         450         0.213721              1       0.000559  
   448         451         0.213721              1       0.000559  
   449         452         0.213721              1       0.000559  
   450         453         0.213721              1        0.00056  
   451         454          0.21372              1        0.00056  
   452         455         0.213718              1        0.00056  
   453         456         0.213714              1        0.00056  
   454         457         0.213707              1        0.00056  
   455         458         0.213698              1         0.0006  
   456         459         0.213693              1       0.000695  
   457         460         0.213691              1       0.000631  
   458         461         0.213691              1       0.000589  
   459         462         0.213691              1       0.000583  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   460         463         0.213691              1       0.000582  
   461         464         0.213691              1        0.00058  
   462         465         0.213691              1       0.000576  
   463         466         0.213691              1        0.00057  
   464         467         0.213691              1        0.00056  
   465         468         0.213691              1       0.000559  
   466         469         0.213691              1       0.000559  
   467         470         0.213691              1       0.000559  
   468         471         0.213689              1       0.000559  
   469         472         0.213686              1       0.000559  
   470         473         0.213678              1        0.00056  
   471         474         0.213659              1        0.00056  
   472         475         0.213616              1       0.000857  
   473         476         0.213542              1        0.00152  
   474         477         0.213465              1        0.00189  
   475         478         0.213429              1        0.00168  
   476         479         0.213423              1        0.00159  
   477         480         0.213423              1        0.00156  
   478         481         0.213423              1        0.00155  
   479         482         0.213423              1        0.00155  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   480         483         0.213423              1        0.00155  
   481         484         0.213423              1        0.00154  
   482         485         0.213423              1        0.00153  
   483         486         0.213423              1        0.00151  
   484         487         0.213422              1        0.00148  
   485         488         0.213421              1        0.00143  
   486         489         0.213419              1        0.00136  
   487         490         0.213412              1        0.00123  
   488         491         0.213394              1        0.00101  
   489         492          0.21335              1       0.000752  
   490         493         0.213241              1       0.000633  
   491         494         0.213007              1       0.000883  
   492         495         0.212617              1        0.00133  
   493         496         0.212232              1        0.00131  
   494         497         0.212068              1        0.00156  
   495         498         0.212045              1        0.00158  
   496         499         0.212044              1        0.00155  
   497         500         0.212044              1        0.00155  
   498         501         0.212044              1        0.00155  
   499         502         0.212044              1        0.00155  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   500         503         0.212044              1        0.00155  
   501         504         0.212044              1        0.00154  
   502         505         0.212043              1        0.00154  
   503         506         0.212043              1        0.00153  
   504         507         0.212043              1        0.00152  
   505         508         0.212042              1        0.00151  
   506         509          0.21204              1        0.00148  
   507         510         0.212035              1        0.00144  
   508         511         0.212022              1        0.00219  
   509         512         0.211987              1        0.00355  
   510         513         0.211896              1         0.0057  
   511         514          0.21167              1        0.00894  
   512         515         0.211136              1         0.0133  
   513         516         0.210062              1         0.0173  
   514         517         0.208534              1         0.0168  
   515         518         0.207383              1         0.0129  
   516         519         0.207045              1         0.0134  
   517         520         0.207014              1         0.0129  
   518         521         0.207013              1         0.0127  
   519         522         0.207013              1         0.0127  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   520         523         0.207012              1         0.0127  
   521         524         0.207012              1         0.0126  
   522         525         0.207011              1         0.0125  
   523         526         0.207007              1         0.0124  
   524         527         0.206998              1         0.0121  
   525         528         0.206975              1         0.0117  
   526         529         0.206914              1          0.011  
   527         530         0.206756              1        0.00979  
   528         531         0.206349              1         0.0122  
   529         532         0.205337              1         0.0191  
   530         533         0.203008              1         0.0278  
   531         534         0.198559              1         0.0338  
   532         535         0.192856              1         0.0287  
   533         536          0.18924              1         0.0166  
   534         537         0.188389              1         0.0165  
   535         538         0.188327              1         0.0159  
   536         539         0.188325              1         0.0157  
   537         540         0.188325              1         0.0157  
   538         541         0.188325              1         0.0157  
   539         542         0.188324              1         0.0156  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   540         543         0.188323              1         0.0156  
   541         544         0.188319              1         0.0154  
   542         545          0.18831              1         0.0152  
   543         546         0.188284              1         0.0149  
   544         547         0.188217              1         0.0234  
   545         548         0.188042              1         0.0386  
   546         549         0.187588              1         0.0631  
   547         550         0.186416              1          0.102  
   548         551         0.183466              1           0.16  
   549         552         0.176489              1          0.239  
   550         553         0.162315              1          0.311  
   551         554         0.141791              1          0.305  
   552         555         0.126003              1          0.175  
   553         556         0.121157              1         0.0447  
   554         557         0.120669              1        0.00419  
   555         558         0.120656              1        0.00171  
   556         559         0.120656              1        0.00171  
   557         560         0.120656              1        0.00171  
   558         561         0.120656              1        0.00171  
   559         562         0.120656              1        0.00171  
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
   560         563         0.120656              1         0.0017  
   561         564         0.120656              1        0.00313  
   562         565         0.120656              1        0.00556  
   563         566         0.120655              1         0.0095  
   564         567         0.120655              1         0.0159  
   565         568         0.120653              1         0.0262  
   566         569         0.120648              1         0.0424  
   567         570         0.120636              1          0.067  
   568         571         0.120607              1          0.101  
   569         572         0.120548              1          0.133  
   570         573         0.120461              1          0.134  
   571         574          0.12039              1         0.0795  
   572         575         0.120367              1         0.0202  
   573         576         0.120365              1        0.00104  
   574         577         0.120365              1       0.000186  
   575         578         0.120365              1       1.76e-05  
   576         579         0.120365              1       4.83e-06  
   577         580         0.120365              1       4.83e-06  

Local minimum possible.

fminunc stopped because the size of the current step is less than
the value of the step size tolerance.

<stopping criteria details>
Plotting figure with the polar normal form equations ... Done. 
```

![figure_6.png
](README_images/figure_6.png
)

We transform the truncated initial condition of our test trajectory according to the obtained change of coordinates, and integrate our reduced order evolution rule to predict the development of the trajectory. 

```matlab:Code
[yRec, etaRec, zRec] = advect(IMInfo, RDInfo, yDataTrunc);
```

# Evaluation of reduced dynamics

The normalized mean trajectory error NMTE is computed as the average distance of the predicted trajectory to the measured one in the observable space, normalized by the observable vector with maximum norm in the data. 

```matlab:Code
normedTrajDist = computeTrajectoryErrors(yRec, yDataTrunc);
NMTE = mean(normedTrajDist(indTest))
```

```text:Output
NMTE = 0.0255
```

We plot the true test set trajectory in the reduced coordinates and compare it to the prediction. 

```matlab:Code
plotReducedCoordinates(etaDataTrunc(indTest,:), etaRec(indTest,:))
legend({'Test set (truncated)', 'Prediction'})
```

![figure_7.png
](README_images/figure_7.png
)

We also plot the measured and predicted tip displacement. The reduced model seems to do well on previously unseen data, provided that it is close to the 2D manifold.

```matlab:Code
plotTrajectories(yData(indTest,:), yRec(indTest,:), 'm', 'DisplayName', {'Test set', 'Prediction'})
ylabel('$u \, [$m$]$','Interpreter','latex')
```

We compare the estimated eigenvalues of the continuous evolution function to the ones computed from the linearized system. 

```matlab:Code
lambda = sort(lambda);
DSEigenvalues = lambda(1:SSMDim)
```

```text:Output
DSEigenvalues = 2x1 complex    
1.0e+02 *

  -0.0309 - 6.5772i
  -0.0309 + 6.5772i

```

```matlab:Code
reconstructedEigenvalues = sort(RDInfo.eigenvaluesLinPartFlow)
```

```text:Output
reconstructedEigenvalues = 2x1 complex    
1.0e+02 *

  -0.0304 - 6.5774i
  -0.0304 + 6.5774i

```

# Backbone curves

With the knowledge of the coefficients of the normal form, we extract backbone curves for the instantaneous damping and frequency. In this delay-embedding example, the reference physical amplitude is that of the first coordinate.

```matlab:Code
zData = transformTrajectories(RDInfo.inverseTransformation.map, etaData);
rhoCal = abs(zData{indTest(1),2}(1,1));
amplitudeFunction = @(x) x(1,:);
figure
BBCInfo = backboneCurves(IMInfo, RDInfo, amplitudeFunction, rhoCal);
subplot(121); ylabel('$u \, [$m$]$','Interpreter','latex')
subplot(122); ylabel('$u \, [$m$]$','Interpreter','latex')
```

# Forced response curves

The data-driven model trained on autonomous data can now be used for forced response predictions. With the addition of forcing, the normal form dynamics becomes 

$\dot{z} =N(z)+f_{red} e^{i\Omega t}$,

where $\Omega$ is the forcing frequency and $f_{red}$ is the forcing amplitude. For FRC extraction, we analytically compute fixed points of the polar normal form via a closed form solution. Our results are compared to those of SSMTool and of direct numerical integrations.

## SSMTool

We first compute the forced response using the full model with SSMTool. We will later compare this result with that obtained from our data-driven reduced order model. 

```matlab:Code
fFull = [15 45 95]; % forcing levels in the full state space
omegaSpan = abs(imag(lambda(1)))*[0.9 1.3];
FRCSSMTool = SSMToolFRCcustom(M, C, K, fnl, fExt, fFull, outdof, omegaSpan, ROMOrder,2e3); % to pick up some hard continuation points
```

```text:Output
Due to high-dimensionality, we compute only the first 5 eigenvalues with the smallest magnitude. These would also be used to compute the spectral quotients
Assuming a proportional damping hypthesis with symmetric matrices
modal damping ratio for 1 mode is 4.698027e-03
modal damping ratio for 2 mode is 1.295171e-02
modal damping ratio for 3 mode is 2.539951e-02
modal damping ratio for 4 mode is 4.202081e-02
modal damping ratio for 5 mode is 6.286832e-02

 The first 10 nonzero eigenvalues are given as 
   1.0e+03 *

  -0.0031 + 0.6577i
  -0.0031 - 0.6577i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.5533 + 8.7842i
  -0.5533 - 8.7842i

*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB

 Run='freqSubint1.ep': Continue equilibria along primary branch.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          5.37e-05  9.30e+02    0.0    0.0    0.0
   1   1  1.00e+00  2.43e-04  7.86e-08  9.30e+02    0.0    0.0    0.0
   2   1  1.00e+00  6.24e-09  1.73e-18  9.30e+02    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:00   9.3016e+02      1  EP      6.5772e+02   1.2996e-03   2.3226e+00   1.0000e+00
   10  00:00:00   9.2602e+02      2          6.5479e+02   9.9151e-04   2.5511e+00   1.0000e+00
   20  00:00:00   9.2103e+02      3          6.5126e+02   6.9584e-04   2.7405e+00   1.0000e+00
   30  00:00:00   9.1603e+02      4          6.4773e+02   5.0646e-04   2.8535e+00   1.0000e+00
   40  00:00:00   9.1103e+02      5          6.4419e+02   3.9001e-04   2.9211e+00   1.0000e+00
   50  00:00:00   9.0603e+02      6          6.4066e+02   3.1479e-04   2.9641e+00   1.0000e+00
   60  00:00:00   9.0104e+02      7          6.3712e+02   2.6311e-04   2.9935e+00   1.0000e+00
   70  00:00:00   8.9604e+02      8          6.3359e+02   2.2571e-04   3.0147e+00   1.0000e+00
   80  00:00:00   8.9104e+02      9          6.3005e+02   1.9748e-04   3.0306e+00   1.0000e+00
   90  00:00:00   8.8604e+02     10          6.2651e+02   1.7546e-04   3.0430e+00   1.0000e+00
  100  00:00:00   8.8104e+02     11          6.2298e+02   1.5782e-04   3.0530e+00   1.0000e+00
  110  00:00:00   8.7604e+02     12          6.1944e+02   1.4339e-04   3.0611e+00   1.0000e+00
  120  00:00:00   8.7104e+02     13          6.1591e+02   1.3136e-04   3.0679e+00   1.0000e+00
  130  00:00:01   8.6604e+02     14          6.1237e+02   1.2118e-04   3.0736e+00   1.0000e+00
  140  00:00:01   8.6104e+02     15          6.0884e+02   1.1247e-04   3.0785e+00   1.0000e+00
  150  00:00:01   8.5604e+02     16          6.0530e+02   1.0492e-04   3.0827e+00   1.0000e+00
  160  00:00:01   8.5104e+02     17          6.0177e+02   9.8314e-05   3.0864e+00   1.0000e+00
  170  00:00:01   8.4604e+02     18          5.9823e+02   9.2492e-05   3.0897e+00   1.0000e+00
  180  00:00:01   8.4104e+02     19          5.9469e+02   8.7319e-05   3.0926e+00   1.0000e+00
  188  00:00:01   8.3715e+02     20  EP      5.9194e+02   8.3679e-05   3.0947e+00   1.0000e+00

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:01   9.3016e+02     21  EP      6.5772e+02   1.2996e-03   2.3226e+00   1.0000e+00
   10  00:00:01   9.3428e+02     22          6.6064e+02   1.6041e-03   2.0154e+00   1.0000e+00
   20  00:00:01   9.3836e+02     23          6.6352e+02   1.7374e-03   1.3626e+00   1.0000e+00
   30  00:00:01   9.3848e+02     24  FP      6.6360e+02   1.6561e-03   1.2007e+00   1.0000e+00
   30  00:00:01   9.3848e+02     25  SN      6.6360e+02   1.6561e-03   1.2007e+00   1.0000e+00
   30  00:00:01   9.3848e+02     26          6.6360e+02   1.6472e-03   1.1869e+00   1.0000e+00
   40  00:00:01   9.3833e+02     27  FP      6.6350e+02   1.3622e-03   8.7235e-01   1.0000e+00
   40  00:00:02   9.3833e+02     28  SN      6.6350e+02   1.3622e-03   8.7235e-01   1.0000e+00
   40  00:00:02   9.3833e+02     29          6.6350e+02   1.3499e-03   8.6161e-01   1.0000e+00
   50  00:00:02   9.3841e+02     30          6.6356e+02   1.2241e-03   7.5850e-01   1.0000e+00
   60  00:00:02   9.3972e+02     31          6.6448e+02   8.8236e-04   5.1819e-01   1.0000e+00
   70  00:00:02   9.4471e+02     32          6.6801e+02   5.3640e-04   3.0563e-01   1.0000e+00
   80  00:00:02   9.4971e+02     33          6.7154e+02   3.9631e-04   2.2414e-01   1.0000e+00
   90  00:00:02   9.5471e+02     34          6.7508e+02   3.1549e-04   1.7786e-01   1.0000e+00
  100  00:00:02   9.5971e+02     35          6.7862e+02   2.6231e-04   1.4763e-01   1.0000e+00
  110  00:00:02   9.6471e+02     36          6.8215e+02   2.2454e-04   1.2625e-01   1.0000e+00
  120  00:00:02   9.6971e+02     37          6.8569e+02   1.9630e-04   1.1030e-01   1.0000e+00
  130  00:00:02   9.7471e+02     38          6.8922e+02   1.7437e-04   9.7932e-02   1.0000e+00
  140  00:00:02   9.7971e+02     39          6.9276e+02   1.5685e-04   8.8064e-02   1.0000e+00
  150  00:00:02   9.8471e+02     40          6.9629e+02   1.4253e-04   8.0005e-02   1.0000e+00
  160  00:00:03   9.8971e+02     41          6.9983e+02   1.3060e-04   7.3297e-02   1.0000e+00
  170  00:00:03   9.9471e+02     42          7.0336e+02   1.2052e-04   6.7628e-02   1.0000e+00
  180  00:00:03   9.9971e+02     43          7.0690e+02   1.1188e-04   6.2773e-02   1.0000e+00
  190  00:00:03   1.0047e+03     44          7.1044e+02   1.0439e-04   5.8568e-02   1.0000e+00
  200  00:00:03   1.0097e+03     45          7.1397e+02   9.7844e-05   5.4891e-02   1.0000e+00
  210  00:00:03   1.0147e+03     46          7.1751e+02   9.2069e-05   5.1648e-02   1.0000e+00
  220  00:00:03   1.0197e+03     47          7.2104e+02   8.6938e-05   4.8768e-02   1.0000e+00
  230  00:00:03   1.0247e+03     48          7.2458e+02   8.2349e-05   4.6191e-02   1.0000e+00
  240  00:00:03   1.0297e+03     49          7.2811e+02   7.8219e-05   4.3873e-02   1.0000e+00
  250  00:00:03   1.0347e+03     50          7.3165e+02   7.4484e-05   4.1777e-02   1.0000e+00
  260  00:00:03   1.0397e+03     51          7.3518e+02   7.1089e-05   3.9871e-02   1.0000e+00
  270  00:00:03   1.0447e+03     52          7.3872e+02   6.7989e-05   3.8132e-02   1.0000e+00
  280  00:00:04   1.0497e+03     53          7.4225e+02   6.5149e-05   3.6539e-02   1.0000e+00
  290  00:00:04   1.0547e+03     54          7.4579e+02   6.2537e-05   3.5073e-02   1.0000e+00
  300  00:00:04   1.0597e+03     55          7.4933e+02   6.0125e-05   3.3720e-02   1.0000e+00
  310  00:00:04   1.0647e+03     56          7.5286e+02   5.7893e-05   3.2467e-02   1.0000e+00
  320  00:00:04   1.0697e+03     57          7.5640e+02   5.5821e-05   3.1305e-02   1.0000e+00
  330  00:00:04   1.0747e+03     58          7.5993e+02   5.3891e-05   3.0222e-02   1.0000e+00
  340  00:00:04   1.0797e+03     59          7.6347e+02   5.2091e-05   2.9213e-02   1.0000e+00
  350  00:00:04   1.0847e+03     60          7.6700e+02   5.0407e-05   2.8268e-02   1.0000e+00
  360  00:00:04   1.0897e+03     61          7.7054e+02   4.8828e-05   2.7382e-02   1.0000e+00
  370  00:00:04   1.0947e+03     62          7.7407e+02   4.7346e-05   2.6551e-02   1.0000e+00
  380  00:00:04   1.0997e+03     63          7.7761e+02   4.5950e-05   2.5768e-02   1.0000e+00
  390  00:00:04   1.1047e+03     64          7.8115e+02   4.4635e-05   2.5030e-02   1.0000e+00
  400  00:00:04   1.1097e+03     65          7.8468e+02   4.3392e-05   2.4333e-02   1.0000e+00
  410  00:00:05   1.1147e+03     66          7.8822e+02   4.2217e-05   2.3674e-02   1.0000e+00
  420  00:00:05   1.1197e+03     67          7.9175e+02   4.1104e-05   2.3050e-02   1.0000e+00
  430  00:00:05   1.1247e+03     68          7.9529e+02   4.0049e-05   2.2458e-02   1.0000e+00
  440  00:00:05   1.1297e+03     69          7.9882e+02   3.9046e-05   2.1895e-02   1.0000e+00
  450  00:00:05   1.1347e+03     70          8.0236e+02   3.8091e-05   2.1360e-02   1.0000e+00
  460  00:00:05   1.1397e+03     71          8.0589e+02   3.7183e-05   2.0851e-02   1.0000e+00
  470  00:00:05   1.1447e+03     72          8.0943e+02   3.6317e-05   2.0365e-02   1.0000e+00
  480  00:00:05   1.1497e+03     73          8.1297e+02   3.5490e-05   1.9901e-02   1.0000e+00
  490  00:00:05   1.1547e+03     74          8.1650e+02   3.4700e-05   1.9458e-02   1.0000e+00
  500  00:00:05   1.1597e+03     75          8.2004e+02   3.3945e-05   1.9034e-02   1.0000e+00
  510  00:00:05   1.1647e+03     76          8.2357e+02   3.3221e-05   1.8629e-02   1.0000e+00
  520  00:00:06   1.1697e+03     77          8.2711e+02   3.2528e-05   1.8240e-02   1.0000e+00
  530  00:00:06   1.1747e+03     78          8.3064e+02   3.1863e-05   1.7867e-02   1.0000e+00
  540  00:00:06   1.1797e+03     79          8.3418e+02   3.1225e-05   1.7509e-02   1.0000e+00
  550  00:00:06   1.1847e+03     80          8.3771e+02   3.0612e-05   1.7165e-02   1.0000e+00
  560  00:00:06   1.1897e+03     81          8.4125e+02   3.0022e-05   1.6835e-02   1.0000e+00
  570  00:00:06   1.1947e+03     82          8.4479e+02   2.9455e-05   1.6517e-02   1.0000e+00
  580  00:00:06   1.1997e+03     83          8.4832e+02   2.8909e-05   1.6210e-02   1.0000e+00
  590  00:00:06   1.2047e+03     84          8.5186e+02   2.8382e-05   1.5915e-02   1.0000e+00
  599  00:00:06   1.2092e+03     85  EP      8.5503e+02   2.7926e-05   1.5659e-02   1.0000e+00
```

![figure_8.png
](README_images/figure_8.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:09
*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB

 Run='freqSubint1.ep': Continue equilibria along primary branch.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.87e-01  9.30e+02    0.0    0.0    0.0
   1   1  1.00e+00  8.15e-02  1.06e-02  9.30e+02    0.0    0.0    0.0
   2   1  1.00e+00  5.75e-04  1.11e-06  9.30e+02    0.0    0.0    0.0
   3   1  1.00e+00  2.05e-08  8.88e-16  9.30e+02    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:00   9.3016e+02      1  EP      6.5772e+02   2.0778e-03   2.7401e+00   1.0000e+00
   10  00:00:00   9.2601e+02      2          6.5478e+02   1.8165e-03   2.7935e+00   1.0000e+00
   20  00:00:00   9.2101e+02      3          6.5125e+02   1.5203e-03   2.8525e+00   1.0000e+00
   30  00:00:00   9.1601e+02      4          6.4771e+02   1.2615e-03   2.9030e+00   1.0000e+00
   40  00:00:00   9.1101e+02      5          6.4418e+02   1.0501e-03   2.9437e+00   1.0000e+00
   50  00:00:00   9.0601e+02      6          6.4064e+02   8.8496e-04   2.9752e+00   1.0000e+00
   60  00:00:00   9.0101e+02      7          6.3711e+02   7.5767e-04   2.9994e+00   1.0000e+00
   70  00:00:00   8.9601e+02      8          6.3357e+02   6.5902e-04   3.0180e+00   1.0000e+00
   80  00:00:00   8.9101e+02      9          6.3003e+02   5.8144e-04   3.0327e+00   1.0000e+00
   90  00:00:00   8.8601e+02     10          6.2650e+02   5.1935e-04   3.0443e+00   1.0000e+00
  100  00:00:00   8.8101e+02     11          6.2296e+02   4.6877e-04   3.0538e+00   1.0000e+00
  110  00:00:00   8.7601e+02     12          6.1943e+02   4.2690e-04   3.0617e+00   1.0000e+00
  120  00:00:00   8.7101e+02     13          6.1589e+02   3.9174e-04   3.0683e+00   1.0000e+00
  130  00:00:01   8.6601e+02     14          6.1236e+02   3.6184e-04   3.0739e+00   1.0000e+00
  140  00:00:01   8.6101e+02     15          6.0882e+02   3.3611e-04   3.0787e+00   1.0000e+00
  150  00:00:01   8.5602e+02     16          6.0529e+02   3.1376e-04   3.0829e+00   1.0000e+00
  160  00:00:01   8.5102e+02     17          6.0175e+02   2.9417e-04   3.0866e+00   1.0000e+00
  170  00:00:01   8.4602e+02     18          5.9821e+02   2.7686e-04   3.0898e+00   1.0000e+00
  180  00:00:01   8.4102e+02     19          5.9468e+02   2.6146e-04   3.0927e+00   1.0000e+00
  188  00:00:01   8.3715e+02     20  EP      5.9194e+02   2.5067e-04   3.0947e+00   1.0000e+00

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:01   9.3016e+02     21  EP      6.5772e+02   2.0778e-03   2.7401e+00   1.0000e+00
   10  00:00:01   9.3431e+02     22          6.6065e+02   2.3426e-03   2.6845e+00   1.0000e+00
   20  00:00:01   9.3931e+02     23          6.6419e+02   2.6573e-03   2.6160e+00   1.0000e+00
   30  00:00:01   9.4431e+02     24          6.6772e+02   2.9619e-03   2.5465e+00   1.0000e+00
   40  00:00:01   9.4931e+02     25          6.7126e+02   3.2541e-03   2.4761e+00   1.0000e+00
   50  00:00:02   9.5430e+02     26          6.7479e+02   3.5340e-03   2.4042e+00   1.0000e+00
   60  00:00:02   9.5930e+02     27          6.7833e+02   3.8020e-03   2.3300e+00   1.0000e+00
   70  00:00:02   9.6430e+02     28          6.8186e+02   4.0589e-03   2.2524e+00   1.0000e+00
   80  00:00:02   9.6930e+02     29          6.8539e+02   4.3054e-03   2.1694e+00   1.0000e+00
   90  00:00:02   9.7430e+02     30          6.8893e+02   4.5419e-03   2.0782e+00   1.0000e+00
  100  00:00:02   9.7929e+02     31          6.9246e+02   4.7681e-03   1.9730e+00   1.0000e+00
  110  00:00:02   9.8429e+02     32          6.9600e+02   4.9818e-03   1.8391e+00   1.0000e+00
  120  00:00:02   9.8902e+02     33          6.9934e+02   5.1536e-03   1.5897e+00   1.0000e+00
  126  00:00:02   9.8923e+02     34  SN      6.9949e+02   5.1496e-03   1.5259e+00   1.0000e+00
  126  00:00:02   9.8923e+02     35  FP      6.9949e+02   5.1496e-03   1.5259e+00   1.0000e+00
  130  00:00:02   9.8920e+02     36          6.9947e+02   5.1432e-03   1.5024e+00   1.0000e+00
  140  00:00:03   9.8771e+02     37          6.9842e+02   5.0383e-03   1.3508e+00   1.0000e+00
  150  00:00:03   9.8272e+02     38          6.9489e+02   4.7440e-03   1.1562e+00   1.0000e+00
  160  00:00:03   9.7772e+02     39          6.9135e+02   4.4471e-03   1.0251e+00   1.0000e+00
  170  00:00:03   9.7272e+02     40          6.8782e+02   4.1350e-03   9.1378e-01   1.0000e+00
  180  00:00:03   9.6773e+02     41          6.8428e+02   3.7993e-03   8.1081e-01   1.0000e+00
  190  00:00:03   9.6273e+02     42          6.8075e+02   3.4280e-03   7.0961e-01   1.0000e+00
  200  00:00:03   9.5773e+02     43          6.7722e+02   2.9962e-03   6.0314e-01   1.0000e+00
  210  00:00:03   9.5273e+02     44          6.7368e+02   2.4226e-03   4.7418e-01   1.0000e+00
  219  00:00:04   9.5016e+02     45  MX      6.7186e+02   1.7465e-03   3.3403e-01   1.0000e+00
```

![figure_9.png
](README_images/figure_9.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:05
*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB

 Run='freqSubint1.ep': Continue equilibria along primary branch.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          7.97e-01  9.30e+02    0.0    0.0    0.0
   1   1  1.00e+00  1.12e-01  4.69e-02  9.30e+02    0.0    0.0    0.0
   2   1  1.00e+00  8.77e-04  1.98e-06  9.30e+02    0.0    0.0    0.0
   3   1  1.00e+00  6.72e-08  2.13e-14  9.30e+02    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:00   9.3016e+02      1  EP      6.5772e+02   2.7233e-03   2.8954e+00   1.0000e+00
   10  00:00:00   9.2601e+02      2          6.5478e+02   2.5108e-03   2.9154e+00   1.0000e+00
   20  00:00:00   9.2101e+02      3          6.5125e+02   2.2612e-03   2.9385e+00   1.0000e+00
   30  00:00:00   9.1601e+02      4          6.4771e+02   2.0239e-03   2.9604e+00   1.0000e+00
   40  00:00:00   9.1101e+02      5          6.4417e+02   1.8046e-03   2.9804e+00   1.0000e+00
   50  00:00:00   9.0601e+02      6          6.4064e+02   1.6074e-03   2.9983e+00   1.0000e+00
   60  00:00:00   9.0101e+02      7          6.3710e+02   1.4343e-03   3.0139e+00   1.0000e+00
   70  00:00:00   8.9601e+02      8          6.3357e+02   1.2851e-03   3.0273e+00   1.0000e+00
   80  00:00:00   8.9101e+02      9          6.3003e+02   1.1578e-03   3.0387e+00   1.0000e+00
   90  00:00:00   8.8601e+02     10          6.2650e+02   1.0495e-03   3.0484e+00   1.0000e+00
  100  00:00:00   8.8101e+02     11          6.2296e+02   9.5720e-04   3.0566e+00   1.0000e+00
  110  00:00:00   8.7601e+02     12          6.1943e+02   8.7829e-04   3.0637e+00   1.0000e+00
  120  00:00:00   8.7101e+02     13          6.1589e+02   8.1039e-04   3.0697e+00   1.0000e+00
  130  00:00:00   8.6601e+02     14          6.1236e+02   7.5159e-04   3.0749e+00   1.0000e+00
  140  00:00:01   8.6101e+02     15          6.0882e+02   7.0031e-04   3.0795e+00   1.0000e+00
  150  00:00:01   8.5601e+02     16          6.0528e+02   6.5528e-04   3.0835e+00   1.0000e+00
  160  00:00:01   8.5101e+02     17          6.0175e+02   6.1550e-04   3.0870e+00   1.0000e+00
  170  00:00:01   8.4601e+02     18          5.9821e+02   5.8012e-04   3.0902e+00   1.0000e+00
  180  00:00:01   8.4101e+02     19          5.9468e+02   5.4849e-04   3.0930e+00   1.0000e+00
  188  00:00:01   8.3715e+02     20  EP      5.9194e+02   5.2625e-04   3.0950e+00   1.0000e+00

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:01   9.3016e+02     21  EP      6.5772e+02   2.7233e-03   2.8954e+00   1.0000e+00
   10  00:00:01   9.3431e+02     22          6.6065e+02   2.9377e-03   2.8751e+00   1.0000e+00
   20  00:00:01   9.3931e+02     23          6.6419e+02   3.1955e-03   2.8504e+00   1.0000e+00
   30  00:00:01   9.4431e+02     24          6.6772e+02   3.4506e-03   2.8256e+00   1.0000e+00
   40  00:00:01   9.4931e+02     25          6.7126e+02   3.7013e-03   2.8009e+00   1.0000e+00
   50  00:00:01   9.5431e+02     26          6.7479e+02   3.9470e-03   2.7763e+00   1.0000e+00
   60  00:00:01   9.5931e+02     27          6.7833e+02   4.1872e-03   2.7517e+00   1.0000e+00
   70  00:00:01   9.6431e+02     28          6.8186e+02   4.4220e-03   2.7274e+00   1.0000e+00
   80  00:00:02   9.6931e+02     29          6.8540e+02   4.6513e-03   2.7031e+00   1.0000e+00
   90  00:00:02   9.7431e+02     30          6.8894e+02   4.8754e-03   2.6789e+00   1.0000e+00
  100  00:00:02   9.7931e+02     31          6.9247e+02   5.0944e-03   2.6548e+00   1.0000e+00
  110  00:00:02   9.8431e+02     32          6.9601e+02   5.3086e-03   2.6307e+00   1.0000e+00
  120  00:00:02   9.8931e+02     33          6.9954e+02   5.5180e-03   2.6067e+00   1.0000e+00
  130  00:00:02   9.9431e+02     34          7.0308e+02   5.7230e-03   2.5826e+00   1.0000e+00
  140  00:00:02   9.9931e+02     35          7.0661e+02   5.9236e-03   2.5585e+00   1.0000e+00
  150  00:00:02   1.0043e+03     36          7.1015e+02   6.1200e-03   2.5343e+00   1.0000e+00
  160  00:00:02   1.0093e+03     37          7.1368e+02   6.3123e-03   2.5100e+00   1.0000e+00
  170  00:00:02   1.0143e+03     38          7.1722e+02   6.5004e-03   2.4857e+00   1.0000e+00
  180  00:00:02   1.0193e+03     39          7.2075e+02   6.6846e-03   2.4612e+00   1.0000e+00
  190  00:00:02   1.0243e+03     40          7.2429e+02   6.8648e-03   2.4366e+00   1.0000e+00
  200  00:00:02   1.0293e+03     41          7.2783e+02   7.0411e-03   2.4118e+00   1.0000e+00
  210  00:00:02   1.0343e+03     42          7.3136e+02   7.2134e-03   2.3869e+00   1.0000e+00
  220  00:00:03   1.0393e+03     43          7.3490e+02   7.3819e-03   2.3617e+00   1.0000e+00
  230  00:00:03   1.0443e+03     44          7.3843e+02   7.5465e-03   2.3364e+00   1.0000e+00
  240  00:00:03   1.0493e+03     45          7.4197e+02   7.7072e-03   2.3108e+00   1.0000e+00
  250  00:00:03   1.0543e+03     46          7.4550e+02   7.8641e-03   2.2850e+00   1.0000e+00
  260  00:00:03   1.0593e+03     47          7.4904e+02   8.0172e-03   2.2589e+00   1.0000e+00
  270  00:00:03   1.0643e+03     48          7.5257e+02   8.1664e-03   2.2325e+00   1.0000e+00
  280  00:00:03   1.0693e+03     49          7.5611e+02   8.3119e-03   2.2057e+00   1.0000e+00
  290  00:00:03   1.0743e+03     50          7.5964e+02   8.4536e-03   2.1785e+00   1.0000e+00
  300  00:00:03   1.0793e+03     51          7.6318e+02   8.5917e-03   2.1508e+00   1.0000e+00
  310  00:00:03   1.0843e+03     52          7.6671e+02   8.7261e-03   2.1226e+00   1.0000e+00
  320  00:00:03   1.0893e+03     53          7.7025e+02   8.8569e-03   2.0937e+00   1.0000e+00
  330  00:00:03   1.0943e+03     54          7.7379e+02   8.9841e-03   2.0640e+00   1.0000e+00
  340  00:00:04   1.0993e+03     55          7.7732e+02   9.1079e-03   2.0333e+00   1.0000e+00
  350  00:00:04   1.1043e+03     56          7.8086e+02   9.2283e-03   2.0015e+00   1.0000e+00
  360  00:00:04   1.1093e+03     57          7.8439e+02   9.3454e-03   1.9682e+00   1.0000e+00
  370  00:00:04   1.1143e+03     58          7.8793e+02   9.4591e-03   1.9330e+00   1.0000e+00
  380  00:00:04   1.1193e+03     59          7.9146e+02   9.5696e-03   1.8953e+00   1.0000e+00
  390  00:00:04   1.1243e+03     60          7.9500e+02   9.6768e-03   1.8540e+00   1.0000e+00
  400  00:00:04   1.1293e+03     61          7.9853e+02   9.7806e-03   1.8074e+00   1.0000e+00
  410  00:00:04   1.1343e+03     62          8.0207e+02   9.8809e-03   1.7515e+00   1.0000e+00
  420  00:00:04   1.1393e+03     63          8.0560e+02   9.9764e-03   1.6733e+00   1.0000e+00
  429  00:00:05   1.1421e+03     64  FP      8.0757e+02   1.0021e-02   1.5591e+00   1.0000e+00
  430  00:00:05   1.1421e+03     65          8.0755e+02   1.0020e-02   1.5528e+00   1.0000e+00
  440  00:00:05   1.1404e+03     66          8.0641e+02   9.9795e-03   1.4719e+00   1.0000e+00
  450  00:00:05   1.1354e+03     67          8.0288e+02   9.8663e-03   1.3809e+00   1.0000e+00
  460  00:00:05   1.1304e+03     68          7.9935e+02   9.7528e-03   1.3209e+00   1.0000e+00
  470  00:00:05   1.1254e+03     69          7.9581e+02   9.6371e-03   1.2716e+00   1.0000e+00
  480  00:00:05   1.1204e+03     70          7.9227e+02   9.5184e-03   1.2283e+00   1.0000e+00
  490  00:00:05   1.1154e+03     71          7.8874e+02   9.3966e-03   1.1888e+00   1.0000e+00
  500  00:00:06   1.1104e+03     72          7.8520e+02   9.2713e-03   1.1520e+00   1.0000e+00
  510  00:00:06   1.1054e+03     73          7.8167e+02   9.1424e-03   1.1171e+00   1.0000e+00
  520  00:00:06   1.1004e+03     74          7.7813e+02   9.0097e-03   1.0838e+00   1.0000e+00
  530  00:00:06   1.0954e+03     75          7.7460e+02   8.8731e-03   1.0516e+00   1.0000e+00
  540  00:00:06   1.0904e+03     76          7.7106e+02   8.7323e-03   1.0203e+00   1.0000e+00
  550  00:00:06   1.0854e+03     77          7.6753e+02   8.5873e-03   9.8986e-01   1.0000e+00
  560  00:00:06   1.0804e+03     78          7.6399e+02   8.4379e-03   9.6000e-01   1.0000e+00
  570  00:00:06   1.0754e+03     79          7.6046e+02   8.2840e-03   9.3065e-01   1.0000e+00
  580  00:00:06   1.0704e+03     80          7.5692e+02   8.1254e-03   9.0173e-01   1.0000e+00
  590  00:00:06   1.0654e+03     81          7.5339e+02   7.9620e-03   8.7316e-01   1.0000e+00
  600  00:00:07   1.0604e+03     82          7.4985e+02   7.7937e-03   8.4487e-01   1.0000e+00
  610  00:00:07   1.0554e+03     83          7.4631e+02   7.6203e-03   8.1682e-01   1.0000e+00
  620  00:00:07   1.0504e+03     84          7.4278e+02   7.4417e-03   7.8897e-01   1.0000e+00
  630  00:00:07   1.0455e+03     85          7.3924e+02   7.2577e-03   7.6125e-01   1.0000e+00
  640  00:00:07   1.0405e+03     86          7.3571e+02   7.0681e-03   7.3365e-01   1.0000e+00
  650  00:00:07   1.0355e+03     87          7.3217e+02   6.8726e-03   7.0610e-01   1.0000e+00
  660  00:00:07   1.0305e+03     88          7.2864e+02   6.6711e-03   6.7858e-01   1.0000e+00
  670  00:00:07   1.0255e+03     89          7.2510e+02   6.4631e-03   6.5103e-01   1.0000e+00
  680  00:00:07   1.0205e+03     90          7.2157e+02   6.2482e-03   6.2340e-01   1.0000e+00
  690  00:00:07   1.0155e+03     91          7.1803e+02   6.0258e-03   5.9561e-01   1.0000e+00
  700  00:00:07   1.0105e+03     92          7.1450e+02   5.7952e-03   5.6760e-01   1.0000e+00
  710  00:00:08   1.0055e+03     93          7.1096e+02   5.5553e-03   5.3925e-01   1.0000e+00
  720  00:00:08   1.0005e+03     94          7.0743e+02   5.3048e-03   5.1042e-01   1.0000e+00
  730  00:00:08   9.9545e+02     95          7.0389e+02   5.0419e-03   4.8095e-01   1.0000e+00
  740  00:00:08   9.9045e+02     96          7.0035e+02   4.7637e-03   4.5056e-01   1.0000e+00
  750  00:00:08   9.8545e+02     97          6.9682e+02   4.4663e-03   4.1888e-01   1.0000e+00
  760  00:00:08   9.8045e+02     98          6.9328e+02   4.1429e-03   3.8529e-01   1.0000e+00
  770  00:00:08   9.7545e+02     99          6.8975e+02   3.7811e-03   3.4865e-01   1.0000e+00
  780  00:00:08   9.7045e+02    100          6.8621e+02   3.3531e-03   3.0643e-01   1.0000e+00
  790  00:00:08   9.6545e+02    101          6.8268e+02   2.7482e-03   2.4850e-01   1.0000e+00
  797  00:00:09   9.6374e+02    102  MX      6.8147e+02   2.2298e-03   2.0015e-01   1.0000e+00
```

![figure_10.png
](README_images/figure_10.png
)

![figure_11.png
](README_images/figure_11.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:12
*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB
gamma = 
   1.0e+13 *

  -0.0000 + 0.0000i
  -0.0000 - 0.0007i
   0.0062 + 4.8426i
```

![figure_12.png
](README_images/figure_12.png
)

![figure_13.png
](README_images/figure_13.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:03
*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB
gamma = 
   1.0e+13 *

  -0.0000 + 0.0000i
  -0.0000 - 0.0007i
   0.0062 + 4.8426i
```

![figure_14.png
](README_images/figure_14.png
)

![figure_15.png
](README_images/figure_15.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:03
```

## Numerical integration

For the purpose of validation and calibration, we also perform a frequency sweep of the system. To save computational time and avoid reruns, `newSweep` can be set to `false`.

```matlab:Code
newSweep = false;
if newSweep
    fSweep = fFull(end)*(M\fExt);
    FRCSweep = integrateSweep(F, [650,800], n, fSweep, observable, ...
        'initRevolutions',150,'stepRevolutions', 150, 'step', 5);
    DataInfo = struct('nElements', nElements, 'fSweep', fSweep, ...
        'outdof', outdof);
    save('dataVKSweep.mat', 'DataInfo', 'FRCSweep')
else
    load('dataVKSweep.mat', 'DataInfo', 'FRCSweep')
end
```

### FRC calibration

We use our normal form dynamics to extract a forced response curve. To this end, we need to define the forcing amplitude in the normal form. We do this by passing to `calibrateFRC` a frequency and a point $y_{{\mathrm{c}\mathrm{a}\mathrm{l}}}$ in the observable space. At the defined frequency, the calibrated FRC will reach the amplitude of this point. 

The vector $y_{{\mathrm{c}\mathrm{a}\mathrm{l}}}$ lies in a delay embedded space, and can be computed either from a delay embedded time-varying response signal, or from a scalar maximal response that is artifically delay embedded. Here, `integrationBasedCalibration` allows for simulation of the forced system, where $y_{{\mathrm{c}\mathrm{a}\mathrm{l}}}$ is computed from the stable response signal. Alternatively, a scalar value $u_{{\mathrm{c}\mathrm{a}\mathrm{l}}}$ can be mapped to the observable space via a cosine function oscillating at the forcing frequency.

```matlab:Code
integrationBasedCalibration = false;
embedDim = size(yData{1,2}, 1);

if integrationBasedCalibration
    Omega = abs(imag(lambda(1)))*0.96;
    uICLinGuess = full(fFull*((-Omega^2*M+K)\fExt));
    FForced = @(t,x,w) F(t,x) + [zeros(n,1); fFull(end)*(M\fExt)*cos(w*t)];
    opts = odeset('RelTol', 1e-4); 
    [t_sim,x_sim] = ode15s(@(t,x) FForced(t,x,Omega),[0 20*2*pi/Omega], [uICLinGuess; zeros(n,1)],opts);
    customFigure(); plot(t_sim,x_sim(:,outdof),'Linewidth',1); drawnow;
    [t_sim,x_sim] = ode15s(@(t,x) FForced(t,x,Omega),t_sim(end)+[0 1*2*pi/Omega], x_sim(end,:)',opts);
    plot(t_sim,x_sim(:,outdof),'Linewidth',1); drawnow;
    uCal = max(abs(x_sim(:,outdof)));
    yCal(:,1) = uCal*cos(Omega*dt*((1:embedDim)-ceil(0.5*embedDim))).';
else
    yCal = zeros(embedDim,length(fFull)); Omega =650*ones(1,length(fFull));
    for iFRC = 1:length(fFull)
    % calibrate at FRC point
    FRC_i = FRCSSMTool.(['F' num2str(iFRC)]);
    [~,pos] =  min(abs(FRC_i.Freq-Omega(iFRC)));
    Omega(iFRC) = FRC_i.Freq(pos); 
    uCal = FRC_i.Amp(pos); 
    yCal(:,iFRC) = uCal*cos(Omega(iFRC)*dt*((1:embedDim)-ceil(0.5*embedDim))).';
    end
end

% forcing levels in the normal form space
fRed = calibrateFRC(IMInfo, RDInfo, yCal, Omega)
```

```text:Output
fRed = 3x1    
    0.2968
    0.8888
    1.8869

```

### Data-driven FRC computation

We now compute the FRC directly from the reduced dynamics model.

```matlab:Code
[IMInfoF,RDInfoF] = forcedSSMROM(IMInfo,RDInfo);
```

```text:Output
Forced SSM reduced-order model assumes external forcing only along the tangent (modal) subspace at the origin. 
```

```matlab:Code
FRCData = analyticalFRC(IMInfoF, RDInfoF, fRed, amplitudeFunction);
```

## FRC plot and evaluation

Comparison of the FRCs from SSMTool and SSMLearn with numerical integration shows that SSMLearn outperforms SSMTool at this forcing level. 

```matlab:Code
customFigure();
colors = colororder;
plot(BBCInfo.frequency/2/pi, BBCInfo.amplitude,'Color',colors(1,:),'Linewidth',2,'DisplayName', 'Backbone - SSMLearn')
plotFRC(FRCData, colors(5,:), '- SSMLearn','freqscale',2*pi)
plotFRC(FRCSSMTool, colors(3,:), '- SSMTool','freqscale',2*pi)
plot(FRCSweep.omega/2/pi,FRCSweep.amp,'.','MarkerSize',16,'Color',colors(2,:),'DisplayName','Numerical integration');
xlim(omegaSpan)
ylim([0,1.06*max(FRCSSMTool.(['F' num2str(length(fFull))]).Amp)])
xlabel('forcing frequency [Hz]')
ylabel('displacement [m]')
set(gca, 'FontSize', 18)
xlim([600 800]/2/pi)
xlim([95 130])
ylim([0 0.02])
legend('location','NW')
```

![figure_16.png
](README_images/figure_16.png
)

```matlab:Code

```

## Evaluation of the conjugacy error

We now perform crossvalidation on the normal form reduced dynamics. Specifically, we vary the polynomial order and track the training and testing performances on the conjugacy error which is used to learn the normal form.

```matlab:Code
errorInfo = conjugacyErrorTrend(etaDataTrunc,indTrain,indTest,3:2:13);
```

```text:Output
Evaluating ROM at order : 3 ... Done. 
Evaluating ROM at order : 5 ... Done. 
Evaluating ROM at order : 7 ... Done. 
Evaluating ROM at order : 9 ... Done. 
Evaluating ROM at order : 11 ... Done. 
Evaluating ROM at order : 13 ... Done. 
```

![figure_17.png
](README_images/figure_17.png
)
